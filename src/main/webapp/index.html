<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Книга відгуків</title>
</head>
<body>

<h2>Новий відгук</h2>
<form id="f">
  <input name="author" placeholder="Автор">
  <textarea name="text" placeholder="Текст"></textarea>
  <button type="submit">Додати</button>
</form>

<h2>Відгуки</h2>
<ul id="list"></ul>

<script>
  async function load() {
    const res = await fetch('/comments');
    const data = await res.json();
    list.innerHTML = data.map(
            c => `<li><b>${c.author}</b>: ${c.text}</li>`
    ).join('');
  }

  f.onsubmit = async e => {
    e.preventDefault();
    const res = await fetch('/comments', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        author: f.author.value,
        text: f.text.value
      })
    });

    if (res.status === 204) {
      f.reset();
      load();
    } else {
      alert('Помилка при додаванні коментаря');
    }
  };

  load();
</script>

</body>
</html>
